<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link href='https://fonts.googleapis.com/css?family=Yantramanav:400,100,300' rel='stylesheet' type='text/css'>
<dom-module id="test-element">
  <style>
    :host {
      font-family: 'Yantramanav';
      font-weight: 100;
      margin: auto;
      display: block;     
    }
    #timer {
      padding: auto;
      margin: auto;
      font-size: 10em;
      width: 300px;
    }
    p {
      width: 100%;
      padding: 0;
      margin: 0;
    }
    #controls {
      width: 300px;
      margin: auto;
      display: flex;
      flex-direction: row;
    }
    paper-button {
      width: 100%;
      background: #ED6A5A; 
    }
  </style>
<template>
  <div id="timer">
    <span>{{computeTime(time)}}</span>
  </div>  
  <div id="controls">
    <paper-button on-tap="startTimer"raised >start</paper-button>
    <paper-button on-tap="endTimer" raised>end</paper-button>
  </div>
  <br>  <br>
  <br>
  <br>
  <br>

      <input type="number" id="time" value="60">  

</template>  
<script>
  var chorus = new Tone.Chorus().toMaster();;

  var synth = new Tone.MonoSynth({
        "oscillator" : {
          "type" : "sine"
        
      },
      "envelope" : {
        "attack" : .5
      }
    }).toMaster();;
    synth.connect(chorus);
  (function() {
    'use strict';
    class TestElement {
      beforeRegister() {
        this.is = 'test-element';
        this.properties = {
          msg: {
            type: String,
            value: 'hola'
          },
          currentTimer: {
            type: Number            
          },
          time: {
            type: Number,
            value: 0
          }
        };        
      }
      startTimer() {  
        if(this.currentTimer == undefined) {
          this.time = Number(this.$.time.value) * 60;                    
          this.currentTimer = window.setInterval(this.count.bind(this), 1000);  
        }              
      } 
      endTimer() {
        if(this.currentTimer) {
          window.clearInterval(this.currentTimer);
          this.currentTimer = undefined;
          this.time = 0;
        }
      }    
                  
      count() {
        this.time -= 1;
        if(this.time === 0) {
          console.log('time');
          var e = synth.triggerAttackRelease('c5','7n');
          this.endTimer();
        }
      }
      computeTime(time) {
        var seconds  = time % 60;
        var minutes = Math.floor(time / 60) ;
        return  minutes + ':' + (seconds.toString().length == 1 ? '0' + seconds : seconds);  
      }
    }
    Polymer(TestElement);
  })();
  </script>
</dom-module>